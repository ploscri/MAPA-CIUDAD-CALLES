<!DOCTYPE html>
<html>

<head>
<meta>

<meta charset="utf-8">
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
	<style type="text/css">


	</style>
</head>
	
<body>
	
	<form>
		<select id="sentido">
			<option value=null>Ninguna</option>
			<option value="DOBLE">Doble mano</option>
			<option value="CRECIENTE">Mano unica ascendente</option>
			<option value="DECRECIENTE">Mano unica descendente</option>
		</select>
	</form>
	
		<script type="text/javascript">
			// template para cargar geojson (contorno.geojson) y topojson v1(callesok_simplify.json)

			//Width and height
			var w = 900;
			var h = 500;
			
			

			//Define map projection
			var projection = d3.geo.transverseMercator()
								   .center([2.5, -34.65])
                       			   .rotate([61.5, 0])
                       			   .scale((h * 750.5) / 3)
                                   .translate([(w/2), (h/2)]);

			//Define path generator
			var path = d3.geo.path()
							 .projection(projection);

			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			
    		var	streetG = svg.append("g").attr("id","calles");
				
			//Load in TopoJSON data
			d3.json("callesconsentido.json", function(error, topology) {
 			streetG.selectAll("path")
				   .data(topojson.feature(topology, topology.objects.layer1).features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .style("fill", "none")
				   .style("stroke", "black")
				   .style("stroke-width", function (d) {
				   			return d.properties.TIPO_C == "AVENIDA" || d.properties.TIPO_C == "AUTOPISTA" ? .5 : .25; 
				   });

			});

			
			var countourG = svg.append("g").attr("id","contorno");

				//Load in GeoJSON data
			
			d3.json("contoro.geojson", function(json) {
		  		countourG.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .style("fill-opacity",0)
				   .style("stroke","black")
				   .style("stroke-width",1);

			});
			
			//lisener
			var estado;
			d3.select("#sentido").on("change", function () {
				var key = this.selectedIndex;
				estado = this.options[key].value;
				redibujo(estado);
				//console.log(estado);
			});
			
			function redibujo(seleccionado) {
				streetG.selectAll("path").transition().delay(function(d, i) { return Math.log(i)*5000;})
					  
					   .style("stroke",function (d) {
				   			return d.properties.SENTIDO == seleccionado ? "black" : "white"; 
				   				})
				   	   
				   	   .style("stroke-opacity",function (d) {
				   			return d.properties.SENTIDO == seleccionado ? 1 : 0; 
				   				});
			}
		
		</script>

</body>

</html>
